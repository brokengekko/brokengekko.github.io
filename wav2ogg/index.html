<script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
<script>
  const { createFFmpeg, fetchFile } = FFmpeg;

  const fileInput = document.getElementById('fileInput');
  const convertBtn = document.getElementById('convertBtn');
  const downloadLink = document.getElementById('downloadLink');

  const ffmpeg = createFFmpeg({ log: true });
  let selectedFile = null;

  fileInput.addEventListener('change', () => {
    selectedFile = fileInput.files[0];
    if (selectedFile) {
      convertBtn.disabled = false;
    }
  });

  convertBtn.addEventListener('click', async () => {
    if (!selectedFile) return;

    convertBtn.disabled = true;
    convertBtn.textContent = 'Loading FFmpeg...';

    if (!ffmpeg.isLoaded()) {
      await ffmpeg.load();
    }

    convertBtn.textContent = 'Converting...';
    ffmpeg.FS('writeFile', 'input.wav', await fetchFile(selectedFile));
    await ffmpeg.run('-i', 'input.wav', '-c:a', 'libopus', 'output.oga');

    const data = ffmpeg.FS('readFile', 'output.oga');
    const blob = new Blob([data.buffer], { type: 'audio/ogg' });
    downloadLink.href = URL.createObjectURL(blob);
    downloadLink.style.display = 'inline-block';

    convertBtn.textContent = 'Convert to OGA';
    convertBtn.disabled = false;
  });
</script>
